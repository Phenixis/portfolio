#!/usr/bin/env sh

date '+%Y-%m-%d %H:%M:%S' >> .husky/pre-push.log
echo "ðŸš€ Running pre-push checks..." >> .husky/pre-push.log

# Check if .env file exists
if [ ! -f ".env" ]; then
    echo "âš ï¸  No .env file found, skipping build check (likely CI/release environment)" >> .husky/pre-push.log
    echo "âœ… Push is allowed to continue without build check." >> .husky/pre-push.log
    exit 0
fi

echo "ðŸ“¦ Building the project..." >> .husky/pre-push.log

if pnpm build >> .husky/pre-push.log 2>&1; then
    echo "âœ… Build succeeded! Push is allowed to continue." >> .husky/pre-push.log
    exit 0
else
    echo "âŒ Build failed! Push has been blocked." >> .husky/pre-push.log
    echo "ðŸ’¡ Please fix the build errors before pushing." >> .husky/pre-push.log
    exit 1
fi